var VORLON;!function(e){var t=function(){function e(){}return e.SetImmediate=function(e){window.setImmediate?setImmediate(e):setTimeout(e,0)},e.Hook=function(e,t,n){var i=e[t];e[t]=function(){for(var t=[],s=0;s<arguments.length;s++)t[s-0]=arguments[s];n(t),i.apply(e,t)}},e.CreateCookie=function(e,t,n){var i;if(n){var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),i="; expires="+s.toUTCString()}else i="";document.cookie=e+"="+t+i+"; path=/"},e.ReadCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var s=n[i];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return""},e.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},e.RemoveEmpties=function(e){for(var t=e.length,n=t-1;n>=0;n--)e[n]||(e.splice(n,1),t--);return t},e.AddClass=function(t,n){if(t.classList){if(n.indexOf(" ")<0)t.classList.add(n);else{var i=n.split(" ");e.RemoveEmpties(i);for(var s=0,o=i.length;o>s;s++)t.classList.add(i[s])}return t}var r,a=t.className,l=a.split(" "),d=e.RemoveEmpties(l);if(n.indexOf(" ")>=0){for(i=n.split(" "),e.RemoveEmpties(i),s=0;d>s;s++){var c=i.indexOf(l[s]);c>=0&&i.splice(c,1)}i.length>0&&(r=i.join(" "))}else{var u=!1;for(s=0;d>s;s++)if(l[s]===n){u=!0;break}u||(r=n)}return r&&(t.className=d>0&&l[0].length>0?a+" "+r:r),t},e.RemoveClass=function(t,n){if(t.classList){if(0===t.classList.length)return t;var i=n.split(" ");e.RemoveEmpties(i);for(var s=0,o=i.length;o>s;s++)t.classList.remove(i[s]);return t}var r=t.className;if(n.indexOf(" ")>=0)i=n.split(" "),e.RemoveEmpties(i);else{if(r.indexOf(n)<0)return t;i=[n]}var a,l=r.split(" "),d=e.RemoveEmpties(l);for(s=d-1;s>=0;s--)i.indexOf(l[s])>=0&&(l.splice(s,1),a=!0);return a&&(t.className=l.join(" ")),t},e}();e.Tools=t}(VORLON||(VORLON={}));var VORLON;!function(e){!function(e){e[e.Client=0]="Client",e[e.Dashboard=1]="Dashboard",e[e.Both=2]="Both"}(e.RuntimeSide||(e.RuntimeSide={}));e.RuntimeSide;!function(e){e[e.OneOne=0]="OneOne",e[e.MulticastReceiveOnly=1]="MulticastReceiveOnly",e[e.Multicast=2]="Multicast"}(e.PluginType||(e.PluginType={}));e.PluginType}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function e(e,t,n){this.loadingDirectory="Vorlon/plugins",this._ready=!0,this._type=0,this.name=e,this.htmlFragmentUrl=t,this.cssStyleSheetUrl=n}return Object.defineProperty(e.prototype,"Type",{get:function(){return this._type},enumerable:!0,configurable:!0}),e.prototype.getID=function(){return""},e.prototype.isReady=function(){return this._ready},e.prototype.startClientSide=function(){},e.prototype.startDashboardSide=function(){},e.prototype.onRealtimeMessageReceivedFromClientSide=function(){},e.prototype.onRealtimeMessageReceivedFromDashboardSide=function(){},e.prototype.refresh=function(){console.error("Please override plugin.refresh()")},e.prototype._insertHtmlContentAsync=function(e,t){var n=this,i="/"+this.loadingDirectory+"/"+this.name+"/",s=!1;e||(e=document.createElement("div"),document.body.appendChild(e),s=!0);var o=new XMLHttpRequest;o.open("GET",i+this.htmlFragmentUrl,!0),o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status)throw new Error("Error status: "+o.status+" - Unable to load "+i+n.htmlFragmentUrl);e.innerHTML=n._stripContent(o.responseText);var r=document.getElementsByTagName("head")[0],a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=i+n.cssStyleSheetUrl,a.media="screen",r.appendChild(a);var l=e.children[0];s&&(l.className="alone"),t(l)}},o.send(null)},e.prototype._loadNewScriptAsync=function(e,t){var n="/"+this.loadingDirectory+"/"+this.name+"/",i=document.createElement("script");i.setAttribute("src",n+e),i.onload=t;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(i,s)},e.prototype._stripContent=function(e){var t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im;if(e){e=e.replace(t,"");var i=e.match(n);i&&(e=i[1])}return e},e}();e.Plugin=t}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(t,n,i,s,o){var r=this;switch(this._isConnected=!1,this._isConnected=!1,this._sessionId=i,this._clientId=s,e.Core._listenClientId=o,this._serverUrl=n,this._waitingEvents=0,t){case 0:this._socket=io.connect(n),this._isConnected=!0;break;case 1:this._socket=io.connect(n+"/dashboard"),this._isConnected=!0}if(this.isConnected){var a=io.Manager(n);a.on("connect_error",function(e){r.onError&&r.onError(e)}),this._socket.on("message",function(e){var t=JSON.parse(e),n=t._pluginID;delete t._pluginID,r.onRealtimeMessageReceived&&r.onRealtimeMessageReceived(n,t)}),this._socket.on("helo",function(t){e.Core._listenClientId=t,r.onHeloReceived&&r.onHeloReceived(t)}),this._socket.on("identify",function(e){r.onIdentifyReceived&&r.onIdentifyReceived(e)}),this._socket.on("stoplisten",function(){r.onStopListenReceived&&r.onStopListenReceived()}),this._socket.on("waitingevents",function(e){if(r.onWaitingEventsReceived){var t=JSON.parse(e);r.onWaitingEventsReceived(t._clientId,t._waitingEvents)}}),this._socket.on("refreshclients",function(){r.onRefreshClients&&r.onRefreshClients()})}}return Object.defineProperty(t.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientId",{set:function(e){this._clientId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socketId",{get:function(){return this._socket.id},enumerable:!0,configurable:!0}),t.prototype.sendWaitingEvents=function(t,n){var i={};if(i._pluginID=t,i._side=0,i._sessionId=this._sessionId,i._clientId=this._clientId,i._listenClientId=e.Core._listenClientId,i._waitingEvents=n,this.isConnected){var s=JSON.stringify(i);this._socket.emit("waitingevents",s)}},t.prototype.sendRealtimeMessage=function(t,n,i,s,o){if(void 0===s&&(s="message"),void 0===o&&(o=!1),n._pluginID=t,n._side=i,n._sessionId=this._sessionId,n._clientId=this._clientId,n._listenClientId=e.Core._listenClientId,!this.isConnected)return this.onRealtimeMessageReceived&&this.onRealtimeMessageReceived(t,n),void 0;if(""===e.Core._listenClientId&&"message"===s)o&&(this._waitingEvents++,this.sendWaitingEvents(t,this._waitingEvents));else{var r=JSON.stringify(n);this._socket.emit(s,r),this._waitingEvents=0,this.sendWaitingEvents(t,0)}},t.prototype.sendMonitoringMessage=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status},n.open("POST",this._serverUrl+"api/push"),n.setRequestHeader("Content-type","application/json;charset=UTF-8");var i=JSON.stringify({_idsession:this._sessionId,id:e,message:t});n.send(i)},t.prototype.getMonitoringMessage=function(e,t,n,i){void 0===n&&(n="-20"),void 0===i&&(i="-1");var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState?200===s.status?t&&t(JSON.parse(s.responseText)):t&&t(null):t&&t(null)},s.open("GET",this._serverUrl+"api/range/"+this._sessionId+"/"+e+"/"+n+"/"+i),s.send()},t}();e.ClientMessenger=t}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"Messenger",{get:function(){return t._messenger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Plugins",{get:function(){return t._plugins},enumerable:!0,configurable:!0}),t.RegisterPlugin=function(e){t._plugins.push(e)},t.Start=function(n,i,s,o){void 0===n&&(n="'http://localhost:1337/'"),void 0===i&&(i=""),void 0===s&&(s=""),void 0===o&&(o=null),t._side=0,t._sessionID=i,t._listenClientId=s,n||(t._side=2),o&&(t._side=1);var r=e.Tools.ReadCookie("vorlonJS_clientId");r||(r=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",r,1)),t._messenger=new e.ClientMessenger(t._side,n,i,r,s),t.Messenger.onRealtimeMessageReceived=t._Dispatch,t.Messenger.onHeloReceived=t._OnIdentificationReceived,t.Messenger.onIdentifyReceived=t._OnIdentifyReceived,t.Messenger.onStopListenReceived=t._OnStopListenReceived,t.Messenger.onError=t._OnError;var a={ua:navigator.userAgent};t.Messenger.sendRealtimeMessage("",a,t._side,"helo");for(var l=0;l<t._plugins.length;l++){var d=t._plugins[l];(2===t._side||0===t._side)&&d.startClientSide(),(2===t._side||1===t._side)&&d.startDashboardSide(o?o(d.getID()):null)}0===t._side&&window.addEventListener("beforeunload",function(){t.Messenger.sendRealtimeMessage("",{socketid:t.Messenger.socketId},t._side,"clientclosed")},!1)},t._OnStopListenReceived=function(){t._listenClientId=""},t._OnIdentifyReceived=function(e){var t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="50%",t.style.marginTop="-150px",t.style.width="100%",t.style.height="300px",t.style.fontFamily="Arial",t.style.fontSize="300px",t.style.textAlign="center",t.style.color="white",t.style.textShadow="2px 2px 5px black",t.innerHTML=e,document.body.appendChild(t),setTimeout(function(){document.body.removeChild(t)},4e3)},t._OnError=function(e){var t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100px",t.style.backgroundColor="red",t.style.textAlign="center",t.style.fontSize="30px",t.style.paddingTop="20px",t.style.color="white",t.style.fontFamily="consolas",t.innerHTML="Error while connecting to server. Server may be offline.<BR>Error message: "+e.message,document.body.appendChild(t),setTimeout(function(){document.body.removeChild(t)},5e3)},t._OnIdentificationReceived=function(e){if(t._listenClientId=e,0===t._side)for(var n=0;n<t._plugins.length;n++){var i=t._plugins[n];i.refresh()}},t._RetrySendingRealtimeMessage=function(e,n){setTimeout(function(){return e.isReady()?(e.onRealtimeMessageReceivedFromClientSide(n),void 0):(t._RetrySendingRealtimeMessage(e,n),void 0)},t._RetryTimeout)},t._Dispatch=function(e,n){var i=n._side;delete n._side;for(var s=0;s<t._plugins.length;s++){var o=t._plugins[s];if(o.getID()===e)return 0===i?o.isReady()?o.onRealtimeMessageReceivedFromClientSide(n):t._RetrySendingRealtimeMessage(o,n):o.onRealtimeMessageReceivedFromDashboardSide(n),void 0}},t._plugins=new Array,t._RetryTimeout=1e3,t}();e.Core=t}(VORLON||(VORLON={}));