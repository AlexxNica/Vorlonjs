var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},VORLON;!function(e){var t=function(t){function n(){t.call(this,"objectExplorer","control.html","control.css"),this.STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,this.ARGUMENT_NAMES=/([^\s,]+)/g,this.rootProperty="window",this._ready=!1,this._contentCallbacks={}}return __extends(n,t),n.prototype.getID=function(){return"OBJEXPLORER"},n.prototype.getFunctionArgumentNames=function(e){var t=[];try{var n=e.toString().replace(this.STRIP_COMMENTS,"");t=n.slice(n.indexOf("(")+1,n.indexOf(")")).match(this.ARGUMENT_NAMES),null===t&&(t=[])}catch(r){console.error(r)}return t},n.prototype._getProperty=function(e){var t=window,n=[this.rootProperty];if(console.log("get property for "+(e||this.rootProperty)),e&&e!==this.rootProperty&&(n=e.split("."),n&&n.length))for(var r=0,o=n.length;o>r&&(t=t[n[r]],t);r++);if(!t)return console.log("not found"),{type:"notfound",name:"not found",fullpath:e,contentFetched:!0,content:[]};var i=this.getObjDescriptor(t,n,!0);return i},n.prototype.getObjDescriptor=function(e,t,n){void 0===n&&(n=!1),t=t||[];var r=t[t.length-1],o=typeof e;null===e&&(o="null"),void 0===e&&(o="undefined");var i=this.rootProperty;r?i=0!==i.indexOf(this.rootProperty+".")&&t[0]!==this.rootProperty?this.rootProperty+"."+t.join("."):t.join("."):(r=this.rootProperty,i=this.rootProperty);var a={type:o,name:r,fullpath:i,contentFetched:!1,content:[],value:null};if("string"===o||"number"===o||"boolean"===o?a.value=e.toString():"function"===o&&(a.value=this.getFunctionArgumentNames(e).join(",")),e&&n){for(var s in e){var c=t.concat([s]);a.content.push(this.getObjDescriptor(e[s],c,!1))}a.contentFetched=!0}return a},n.prototype._packageAndSendObjectProperty=function(t,n){n=n||this._currentPropertyPath;var r=this._getProperty(n);e.Core.Messenger.sendRealtimeMessage(this.getID(),{type:t,path:r.fullpath,property:r},e.RuntimeSide.Client)},n.prototype._markForRefresh=function(){var e=this;this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){e.refresh()},1e4)},n.prototype.startClientSide=function(){var t=this;document.addEventListener("DOMContentLoaded",function(){e.Core.Messenger.isConnected&&(document.addEventListener("DOMNodeInserted",function(){t._markForRefresh()}),document.addEventListener("DOMNodeRemoved",function(){t._markForRefresh()})),t.refresh()})},n.prototype.onRealtimeMessageReceivedFromDashboardSide=function(e){switch(e.type){case"query":this._currentPropertyPath=e.path,this._packageAndSendObjectProperty(e.type);break;case"queryContent":this._packageAndSendObjectProperty(e.type,e.path)}},n.prototype.refresh=function(){this._packageAndSendObjectProperty("refresh")},n.prototype.startDashboardSide=function(e){var t=this;void 0===e&&(e=null),this._dashboardDiv=e,this._insertHtmlContentAsync(this._dashboardDiv,function(e){t._containerDiv=e,t._searchBoxInput=t._containerDiv.querySelector("#txtPropertyName"),t._searchBtn=t._containerDiv.querySelector("#btnSearchProp"),t._searchUpBtn=t._containerDiv.querySelector("#btnSearchUp"),t._treeDiv=t._containerDiv.querySelector("#treeViewObj"),t._searchBtn.onclick=function(){var e=t._searchBoxInput.value;e&&t.setCurrent(e)},t._searchUpBtn.onclick=function(){var e=t._searchBoxInput.value;if(e){var n=e.split(".");n.length>1&&(n.splice(n.length-1,1),t.setCurrent(n.join(".")))}},t._searchBoxInput.addEventListener("keydown",function(e){if(13===e.keyCode||9===e.keyCode){var n=t._searchBoxInput.value;n&&t.setCurrent(n)}}),t._ready=!0})},n.prototype.setCurrent=function(e){this._searchBoxInput.value=e,this._currentPropertyPath=e,this._queryObjectContent(this._currentPropertyPath),this._treeDiv.scrollTop=0},n.prototype._queryObjectContent=function(t){e.Core.Messenger.sendRealtimeMessage(this.getID(),{type:"query",path:t},e.RuntimeSide.Dashboard)},n.prototype._appendSpan=function(e,t,n){var r=document.createElement("span");r.className=t,r.innerHTML=n,e.appendChild(r)},n.prototype._generateColorfullLink=function(e,t){this._appendSpan(e,"nodeName",t.name),"object"!==t.type&&this._appendSpan(e,"nodeType","("+t.type+")"),t.value&&this._appendSpan(e,"nodeValue",t.value)},n.prototype._generateButton=function(e,t,n,r){var o=document.createElement("div");return o.innerHTML=t,o.className=n,o.addEventListener("click",function(){return r(o)}),e.appendChild(o),o},n.prototype._generateTreeNode=function(t,n,r){var o=this;void 0===r&&(r=!1);var i=document.createElement("div");t.appendChild(i);var a=null,s=document.createElement("div");s.style.display="none";var c=function(){if(n.contentFetched&&n.content&&n.content.length){for(var e=n.content.sort(function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n>r?1:r>n?-1:0}),t=0,r=e.length;r>t;t++)o._generateTreeNode(s,e[t]);s.style.display=""}},p=function(t){n.contentFetched||(o._contentCallbacks[n.fullpath]=function(e){o._contentCallbacks[n.fullpath]=null,n.contentFetched=!0,n.content=e.content,c()},e.Core.Messenger.sendRealtimeMessage(o.getID(),{type:"queryContent",path:n.fullpath},e.RuntimeSide.Dashboard)),"none"===s.style.display?(s.style.display="",t.innerHTML="-"):(s.style.display="none",t.innerHTML="+")};"object"===n.type&&(a=this._generateButton(i,"+","treeNodeButton",function(){p(a)}));var u=null;"object"===n.type?(u=document.createElement("a"),u.addEventListener("click",function(){p(a)}),u.href="#",u.className="treeNodeHeader"):u=document.createElement("span"),this._generateColorfullLink(u,n),i.appendChild(u),"object"===n.type&&this._generateButton(i,"...","attachNode",function(){o.setCurrent(n.fullpath)}),i.className=r?"firstTreeNodeText":"treeNodeText",c(),i.appendChild(s)},n.prototype.onRealtimeMessageReceivedFromClientSide=function(e){if("query"===e.type||"refresh"===e.type){for(;this._treeDiv.hasChildNodes();)this._treeDiv.removeChild(this._treeDiv.lastChild);this._searchBoxInput.value=e.path,this._generateTreeNode(this._treeDiv,e.property,!0)}else if("queryContent"===e.type){var t=this._contentCallbacks[e.path];t&&t(e.property)}},n}(e.Plugin);e.ObjectExplorerPlugin=t,e.Core.RegisterPlugin(new t)}(VORLON||(VORLON={}));